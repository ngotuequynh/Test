{"version":3,"file":"trade.min.js","sources":["../src/trade.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Trade module.\n *\n * @copyright  2017 Adrian Greeve - adriangreeve.com\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/log',\n    'block_stash/base',\n    'block_stash/item',\n    'block_stash/user-item',\n    'core/pubsub'\n], function($, Ajax, Log, Base, Item, UserItem, PubSub) {\n\n    /**\n     * Trade class.\n     *\n     * @param {Object} tradedata The data of this trade widget.\n     */\n    function Trade(tradedata) {\n        Base.prototype.constructor.apply(this, [tradedata]);\n    }\n    Trade.prototype = Object.create(Base.prototype);\n\n    Trade.prototype.EVENT_TRADE = 'trade:pickedup';\n\n\n    Trade.prototype.do = function() {\n\n        return Ajax.call([{\n            methodname: 'block_stash_complete_trade',\n            args: {\n                tradeid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].fail(function() {\n            Log.debug('The trade could not be completed.');\n\n        }).then(function(data) {\n\n            // Notify other areas about item removal and acquirement.\n            if (data) {\n                for (var index in data.gaineditems) {\n\n                    var userItem = new UserItem(data.gaineditems[index].useritem, new Item(data.gaineditems[index].item));\n                    PubSub.publish(this.EVENT_TRADE, {\n                        id: this.get('id'),\n                        hashcode: this.get('hashcode'),\n                        useritem: userItem\n                    });\n                }\n\n                for (var index in data.removeditems) {\n                    var userItem = new UserItem(data.removeditems[index].useritem, new Item(data.removeditems[index].item));\n                    PubSub.publish(this.EVENT_TRADE, {\n                        id: this.get('id'),\n                        hashcode: this.get('hashcode'),\n                        useritem: userItem\n                    });\n                }\n            }\n\n        }.bind(this));\n    };\n\n\n    return /** @alias module:block_stash/trade */ Trade;\n\n});\n"],"names":["define","$","Ajax","Log","Base","Item","UserItem","PubSub","Trade","tradedata","prototype","constructor","apply","this","Object","create","EVENT_TRADE","do","call","methodname","args","tradeid","get","hashcode","fail","debug","then","data","index","gaineditems","userItem","useritem","item","publish","id","removeditems","bind"],"mappings":";;;;;;AAsBAA,2BAAO,CACH,SACA,YACA,WACA,mBACA,mBACA,wBACA,gBACD,SAASC,EAAGC,KAAMC,IAAKC,KAAMC,KAAMC,SAAUC,iBAOnCC,MAAMC,WACXL,KAAKM,UAAUC,YAAYC,MAAMC,KAAM,CAACJ,mBAE5CD,MAAME,UAAYI,OAAOC,OAAOX,KAAKM,WAErCF,MAAME,UAAUM,YAAc,iBAG9BR,MAAME,UAAUO,GAAK,kBAEVf,KAAKgB,KAAK,CAAC,CACdC,WAAY,6BACZC,KAAM,CACFC,QAASR,KAAKS,IAAI,MAClBC,SAAUV,KAAKS,IAAI,gBAEvB,GAAGE,MAAK,WACRrB,IAAIsB,MAAM,wCAEXC,KAAK,SAASC,SAGTA,KAAM,KACD,IAAIC,SAASD,KAAKE,YAAa,KAE5BC,SAAW,IAAIxB,SAASqB,KAAKE,YAAYD,OAAOG,SAAU,IAAI1B,KAAKsB,KAAKE,YAAYD,OAAOI,OAC/FzB,OAAO0B,QAAQpB,KAAKG,YAAa,CAC7BkB,GAAIrB,KAAKS,IAAI,MACbC,SAAUV,KAAKS,IAAI,YACnBS,SAAUD,eAIb,IAAIF,SAASD,KAAKQ,aAAc,CAC7BL,SAAW,IAAIxB,SAASqB,KAAKQ,aAAaP,OAAOG,SAAU,IAAI1B,KAAKsB,KAAKQ,aAAaP,OAAOI,OACjGzB,OAAO0B,QAAQpB,KAAKG,YAAa,CAC7BkB,GAAIrB,KAAKS,IAAI,MACbC,SAAUV,KAAKS,IAAI,YACnBS,SAAUD,cAKxBM,KAAKvB,QAImCL"}