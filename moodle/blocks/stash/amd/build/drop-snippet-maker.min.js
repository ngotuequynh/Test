/**
 * Drop snippet maker module.
 *
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_stash/drop-snippet-maker",["jquery"],(function($){function Maker(drop){this._drop=drop}return Maker.prototype.IMAGE="image",Maker.prototype.IMAGEANDBUTTON="imageandbutton",Maker.prototype.TEXT="text",Maker.prototype._actionText=null,Maker.prototype._displayType=Maker.prototype.IMAGEANDBUTTON,Maker.prototype._label=null,Maker.prototype._getActionText=function(){return null===this._actionText||""===this._actionText.trim()?this.getDefaultActionText():this._actionText},Maker.prototype._getAnchor=function(){return $('<a href="#"></a>')},Maker.prototype.getDefaultActionText=function(){return"Pick up!"},Maker.prototype.getDefaultLabel=function(){return"Pick up '"+this.getItem().get("name")+"'"},Maker.prototype._getDisplayButton=function(){var wrap=$('<div class="item-action"></div>'),btn=$('<button class="btn btn-secondary"></button>');return btn.text(this._getActionText()),wrap.append(btn),wrap},Maker.prototype._getDisplayImage=function(){var img=$('<div class="item-image"></div>'),label=$('<div class="item-label"></div>');return img.addClass("item-image"),img.css("backgroundImage","url("+this.getItem().get("imageurl")+")"),label.text(this.getItem().get("name")),label.attr("title",this.getItem().get("name")),img.append(label),img},Maker.prototype.getDrop=function(){return this._drop},Maker.prototype.getDisplay=function(){return this._getDisplayType(this._displayType)},Maker.prototype._getDisplayType=function(displaytype){var display,anchor;return displaytype==this.IMAGE?(display=$('<div class="block-stash-item"></div>'),window.console.log(display),window.console.log("display"),(anchor=this._getAnchor()).append(this._getDisplayImage()),display.append(anchor)):displaytype==this.IMAGEANDBUTTON?(display=$('<div class="block-stash-item"></div>'),window.console.log(display),window.console.log("display"),display.append(this._getDisplayImage()),display.append(this._getDisplayButton())):(display=$("<span></span>"),window.console.log(display),window.console.log("display"),(anchor=this._getAnchor()).text(this._getLabel()),display.append(anchor)),display},Maker.prototype.getItem=function(){return this._drop.getItem()},Maker.prototype._getLabel=function(){return null===this._label||""===this._label.trim()?this.getDefaultLabel():this._label},Maker.prototype.getSnippet=function(){var node=$("<div>"),uuid=this.uuid(),wrapper=$('<span id="'+uuid+'">'),script=$('<script type="text/javascript">'),id=this.getDrop().get("id"),hashcode=this.getDrop().get("hashcode"),display=this.getDisplay(),snippet="";return snippet='require(["jquery", "block_stash/drop"], function($, D) { var d = new D({id: '+id+', hashcode: "'+hashcode+'"}), n = $("#'+uuid+'"); if (!n.length) return; n.removeClass(); d.isVisible().then(function() { n.show(); }); n.find("a, button").click(function(e) { e.preventDefault(); d.pickup(); n.remove(); });})',snippet=this._wrapForOnReady(snippet),node.append(wrapper),wrapper.css("display","none"),wrapper.append(display),wrapper.append(script),script.html(snippet),node.html()},Maker.prototype.setDisplayType=function(v){this._displayType=v},Maker.prototype.setActionText=function(v){this._actionText=v},Maker.prototype.setLabel=function(v){this._label=v},Maker.prototype.uuid=function(){return Math.random().toString(36).substring(2,7)+(new Date).getTime().toString(36)},Maker.prototype._wrapForOnReady=function(code){return'document.addEventListener("DOMContentLoaded", function(e) {'+code+"});"},Maker}));

//# sourceMappingURL=drop-snippet-maker.min.js.map