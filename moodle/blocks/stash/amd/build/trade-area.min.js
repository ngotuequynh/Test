/**
 * Trade module.
 *
 * @copyright  2017 Adrian Greeve <adriangreeve.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_stash/trade-area",["jquery","core/templates","block_stash/drop","core/notification","block_stash/trade","core/pubsub"],(function($,Templates,Drop,notification,Trade,PubSub){function TradeArea(node){this._node=$(node),this._setUp(),this._update()}return TradeArea.prototype._node=null,TradeArea.prototype._setUp=function(){PubSub.subscribe("block_stash/drop/pickedup",this._dropPickedUpListener.bind(this)),PubSub.subscribe("trade:pickedup",this._dropPickedUpListener.bind(this))},TradeArea.prototype.containsItem=function(id){return this.getTradeItemNode(id).length>0},TradeArea.prototype._dropPickedUpListener=function(e){var userItem=e.useritem;this.containsItem(userItem.getItem().get("id"))&&this.updateTradeItemUserQuantity(userItem)},TradeArea.prototype.canTradeItems=function(){var removeditemnodes=this._node.find(".removed-items"),hasenough=!0;return removeditemnodes.each((function(i,node){hasenough=hasenough&&$(node).data("hasenough")})),hasenough},TradeArea.prototype.getTradeItemNode=function(id){return this._node.find(".removed-items[data-itemid="+id+"]")},TradeArea.prototype.updateTradeItemUserQuantity=function(userItem){var itemid=userItem.getItem().get("id"),node=this.getTradeItemNode(itemid),newQuantity=parseInt(userItem.get("quantity"),10),quantity=parseInt(node.attr("data-quantity"),10),tradeid=node.parent().attr("data-tradeid"),name=userItem.getItem().get("name"),context={enoughitems:newQuantity>=quantity,itemid:itemid,quantity:quantity,name:name,userquantity:newQuantity};Templates.render("block_stash/tradeitem_detail",context).done(function(html,js){Templates.replaceNodeContents($(".block-stash-trade-item-"+itemid+'[data-tradeid="'+tradeid+'"]'),html,js),this._update()}.bind(this)).fail(notification.exception)},TradeArea.prototype._update=function(){var btn=this._node.find(".accept-trade button").first();btn&&(this.canTradeItems()?btn.prop("disabled",!1):btn.prop("disabled",!0))},TradeArea}));

//# sourceMappingURL=trade-area.min.js.map