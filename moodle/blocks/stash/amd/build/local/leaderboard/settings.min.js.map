{"version":3,"file":"settings.min.js","sources":["../../../src/local/leaderboard/settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Leaderboard settings JavaScript\n *\n * @copyright 2023 Adrian Greeve <adriangreeve.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {add as addToast} from 'core/toast';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\n\nexport const init = () => {\n    let lbsetting = document.querySelector('.block-stash-lbsetting');\n    lbsetting.addEventListener('change', (e) => {\n\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast(getString('settingupdated', 'block_stash'), {\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n\n        let mainboards = document.querySelector('.block_stash_lb_cards');\n        if (currenttarget.checked) {\n            mainboards.classList.remove('invisible');\n        } else {\n            mainboards.classList.add('invisible');\n        }\n    });\n\n    let lbgroupswitch = document.querySelector('.block-stash-lbgroups');\n    lbgroupswitch.addEventListener('change', (e) => {\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard_groups', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast(getString('settingupdated', 'block_stash'), {\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n    });\n\n    let otherboards = document.querySelectorAll('.block_stash-leaderboard');\n    otherboards.forEach((board) => {\n        board.addEventListener('change', (e) => {\n            let otherboardelement = e.currentTarget;\n            let enabled = otherboardelement.checked;\n\n            let boardlimit = otherboardelement.parentNode.parentNode.querySelector('.block_stash-leaderboard-limit');\n            if (!enabled) {\n                boardlimit.setAttribute('disabled', true);\n            } else {\n                boardlimit.removeAttribute('disabled');\n            }\n            const hiddenthing = otherboardelement.parentNode.parentNode.querySelector('input[type=\"hidden\"]');\n            const options = hiddenthing.dataset.options;\n\n            updateLeaderboard(otherboardelement.dataset.courseid, otherboardelement.dataset.location, options, 'DESC',\n                boardlimit.value, enabled)\n            .then((result) => {\n                if (result) {\n                    addToast(getString('settingupdated', 'block_stash'), {\n                        type: 'info',\n                        autohide: true,\n                        closeButton: true,\n                    });\n                }\n            });\n        });\n    });\n\n    let rowlimits = document.querySelectorAll('.block_stash_change_element');\n    rowlimits.forEach((limit) => {\n        limit.addEventListener('change', (e) => {\n            let currenttarget = e.currentTarget;\n            let otherthing = currenttarget.parentNode.parentNode.parentNode.querySelector('.block_stash-leaderboard');\n            let rowlimit = otherthing.parentNode.parentNode.querySelector('.block_stash-leaderboard-limit');\n            const hiddenthing = otherthing.parentNode.parentNode.querySelector('input[type=\"hidden\"]');\n            const options = hiddenthing.dataset.options;\n            updateLeaderboard(otherthing.dataset.courseid, otherthing.dataset.location, options, 'DESC', rowlimit.value, true)\n            .then((result) => {\n                if (result) {\n                    addToast(getString('settingupdated', 'block_stash'), {\n                        type: 'info',\n                        autohide: true,\n                        closeButton: true,\n                    });\n                }\n            });\n        });\n    });\n};\n\nconst updateSetting = (courseid, key, value) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_settings',\n        args: {\n            courseid: courseid,\n            key: key,\n            value: value\n        }\n    }])[0];\n};\n\nconst updateLeaderboard = (courseid, title, options, sortorder, limit, enabled) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_update',\n        args: {\n            courseid: courseid,\n            boardname: title,\n            options: options,\n            sortorder: sortorder,\n            rowlimit: limit,\n            enabled: enabled\n        }\n    }])[0];\n};\n"],"names":["document","querySelector","addEventListener","e","currenttarget","currentTarget","updateSetting","dataset","courseid","checked","then","result","type","autohide","closeButton","mainboards","classList","remove","add","querySelectorAll","forEach","board","otherboardelement","enabled","boardlimit","parentNode","removeAttribute","setAttribute","options","updateLeaderboard","location","value","limit","otherthing","rowlimit","key","Ajax","call","methodname","args","title","sortorder","boardname"],"mappings":";;;;;;oJA0BoB,KACAA,SAASC,cAAc,0BAC7BC,iBAAiB,UAAWC,QAE9BC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,cAAeJ,cAAcK,SAASC,MAAMC,SAClFA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,WAKrBC,WAAaf,SAASC,cAAc,yBACpCG,cAAcK,QACdM,WAAWC,UAAUC,OAAO,aAE5BF,WAAWC,UAAUE,IAAI,gBAIblB,SAASC,cAAc,yBAC7BC,iBAAiB,UAAWC,QAClCC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,qBAAsBJ,cAAcK,SAASC,MAAMC,SACzFA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,UAMXd,SAASmB,iBAAiB,4BAChCC,SAASC,QACjBA,MAAMnB,iBAAiB,UAAWC,QAC1BmB,kBAAoBnB,EAAEE,cACtBkB,QAAUD,kBAAkBb,QAE5Be,WAAaF,kBAAkBG,WAAWA,WAAWxB,cAAc,kCAClEsB,QAGDC,WAAWE,gBAAgB,YAF3BF,WAAWG,aAAa,YAAY,SAKlCC,QADcN,kBAAkBG,WAAWA,WAAWxB,cAAc,wBAC9CM,QAAQqB,QAEpCC,kBAAkBP,kBAAkBf,QAAQC,SAAUc,kBAAkBf,QAAQuB,SAAUF,QAAS,OAC/FJ,WAAWO,MAAOR,SACrBb,MAAMC,SACCA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,aAOjBd,SAASmB,iBAAiB,+BAChCC,SAASY,QACfA,MAAM9B,iBAAiB,UAAWC,QAE1B8B,WADgB9B,EAAEE,cACSoB,WAAWA,WAAWA,WAAWxB,cAAc,4BAC1EiC,SAAWD,WAAWR,WAAWA,WAAWxB,cAAc,wCAExD2B,QADcK,WAAWR,WAAWA,WAAWxB,cAAc,wBACvCM,QAAQqB,QACpCC,kBAAkBI,WAAW1B,QAAQC,SAAUyB,WAAW1B,QAAQuB,SAAUF,QAAS,OAAQM,SAASH,OAAO,GAC5GrB,MAAMC,SACCA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,oBAQ/BR,cAAgB,CAACE,SAAU2B,IAAKJ,QAC3BK,cAAKC,KAAK,CAAC,CACdC,WAAY,mCACZC,KAAM,CACF/B,SAAUA,SACV2B,IAAKA,IACLJ,MAAOA,UAEX,GAGFF,kBAAoB,CAACrB,SAAUgC,MAAOZ,QAASa,UAAWT,MAAOT,UAC5Da,cAAKC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACF/B,SAAUA,SACVkC,UAAWF,MACXZ,QAASA,QACTa,UAAWA,UACXP,SAAUF,MACVT,QAASA,YAEb"}