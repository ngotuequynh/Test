{"version":3,"file":"drop.min.js","sources":["../src/drop.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop module.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/log',\n    'block_stash/base',\n    'block_stash/item',\n    'block_stash/user-item',\n    'core/pubsub'\n], function($, Ajax, Log, Base, Item, UserItem, PubSub) {\n\n    /**\n     * Drop class.\n     *\n     * @param {Object} dropdata The data of this drop.\n     * @param {Item} item The item related to this drop.\n     */\n    function Drop(dropdata, item) {\n        Base.prototype.constructor.apply(this, [dropdata]);\n        this._item = item;\n    }\n    Drop.prototype = Object.create(Base.prototype);\n\n    Drop.prototype.EVENT_PICKEDUP = 'drop:pickedup';\n\n    /**\n     * Return the item of this drop.\n     *\n     * @return {Item}\n     */\n    Drop.prototype.getItem = function() {\n        return this._item;\n    };\n\n    /**\n     * Is the drop visible to the current user?\n     *\n     * @return {Promise} Rejected when not visible.\n     */\n    Drop.prototype.isVisible = function() {\n        return Ajax.call([{\n            methodname: 'block_stash_is_drop_visible',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].then(function(visible) {\n            if (!visible) {\n                return $.Deferred().reject();\n            }\n            return true;\n        });\n    };\n\n    /**\n     * Report the drop has having been picked up.\n     *\n     * @return {Promise} Resolved when picked up without errors.\n     */\n    Drop.prototype.pickup = function() {\n        return Ajax.call([{\n            methodname: 'block_stash_pickup_drop',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].fail(function() {\n            Log.debug('The item could not be picked up.');\n\n        }).then(function(data) {\n            // Do not change this._item as it's not a predictable behaviour.\n            var userItem = new UserItem(data.useritem, new Item(data.item));\n            PubSub.publish('block_stash/drop/pickedup', {\n                id: this.get('id'),\n                hashcode: this.get('hashcode'),\n                useritem: userItem\n            });\n        }.bind(this));\n    };\n\n    return /** @alias module:block_stash/drop */ Drop;\n\n});\n"],"names":["define","$","Ajax","Log","Base","Item","UserItem","PubSub","Drop","dropdata","item","prototype","constructor","apply","this","_item","Object","create","EVENT_PICKEDUP","getItem","isVisible","call","methodname","args","dropid","get","hashcode","then","visible","Deferred","reject","pickup","fail","debug","data","userItem","useritem","publish","id","bind"],"mappings":";;;;;;AAsBAA,0BAAO,CACH,SACA,YACA,WACA,mBACA,mBACA,wBACA,gBACD,SAASC,EAAGC,KAAMC,IAAKC,KAAMC,KAAMC,SAAUC,iBAQnCC,KAAKC,SAAUC,MACpBN,KAAKO,UAAUC,YAAYC,MAAMC,KAAM,CAACL,gBACnCM,MAAQL,YAEjBF,KAAKG,UAAYK,OAAOC,OAAOb,KAAKO,WAEpCH,KAAKG,UAAUO,eAAiB,gBAOhCV,KAAKG,UAAUQ,QAAU,kBACdL,KAAKC,OAQhBP,KAAKG,UAAUS,UAAY,kBAChBlB,KAAKmB,KAAK,CAAC,CACdC,WAAY,8BACZC,KAAM,CACFC,OAAQV,KAAKW,IAAI,MACjBC,SAAUZ,KAAKW,IAAI,gBAEvB,GAAGE,MAAK,SAASC,iBACZA,SACM3B,EAAE4B,WAAWC,aAWhCtB,KAAKG,UAAUoB,OAAS,kBACb7B,KAAKmB,KAAK,CAAC,CACdC,WAAY,0BACZC,KAAM,CACFC,OAAQV,KAAKW,IAAI,MACjBC,SAAUZ,KAAKW,IAAI,gBAEvB,GAAGO,MAAK,WACR7B,IAAI8B,MAAM,uCAEXN,KAAK,SAASO,UAETC,SAAW,IAAI7B,SAAS4B,KAAKE,SAAU,IAAI/B,KAAK6B,KAAKxB,OACzDH,OAAO8B,QAAQ,4BAA6B,CACxCC,GAAIxB,KAAKW,IAAI,MACbC,SAAUZ,KAAKW,IAAI,YACnBW,SAAUD,YAEhBI,KAAKzB,QAGkCN"}