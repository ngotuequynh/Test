{"version":3,"file":"drop-snippet-maker.min.js","sources":["../src/drop-snippet-maker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop snippet maker module.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n], function($) {\n\n    /**\n     * Drop snippet maker class.\n     *\n     * @param {Drop} drop The drop.\n     */\n    function Maker(drop) {\n        this._drop = drop;\n    }\n\n    Maker.prototype.IMAGE = 'image';\n    Maker.prototype.IMAGEANDBUTTON = 'imageandbutton';\n    Maker.prototype.TEXT = 'text';\n\n    Maker.prototype._actionText = null;\n    Maker.prototype._displayType = Maker.prototype.IMAGEANDBUTTON;\n    Maker.prototype._label = null;\n\n    /**\n     * Get the action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getActionText = function() {\n        if (this._actionText === null || this._actionText.trim() === '') {\n            return this.getDefaultActionText();\n        }\n        return this._actionText;\n    };\n\n    /**\n     * Get the anchor.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getAnchor = function() {\n        return $('<a href=\"#\"></a>');\n    };\n\n    /**\n     * Get the default action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultActionText = function() {\n        return 'Pick up!';\n    };\n\n    /**\n     * Get the default label.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultLabel = function() {\n        return \"Pick up '\" + this.getItem().get('name') + \"'\";\n    };\n\n    /**\n     * Get the button.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getDisplayButton = function() {\n        var wrap = $('<div class=\"item-action\"></div>'),\n            btn = $('<button class=\"btn btn-secondary\"></button>');\n\n        btn.text(this._getActionText());\n        wrap.append(btn);\n\n        return wrap;\n    };\n\n    /**\n     * Get the image.\n     *\n     * @return {Node}\n     */\n\n    Maker.prototype._getDisplayImage = function() {\n        var img = $('<div class=\"item-image\"></div>'),\n            label = $('<div class=\"item-label\"></div>');\n\n        img.addClass('item-image');\n        img.css('backgroundImage', 'url(' + this.getItem().get('imageurl') + ')');\n        label.text(this.getItem().get('name'));\n        label.attr('title', this.getItem().get('name'));\n        img.append(label);\n\n        return img;\n    };\n\n    /**\n     * Get the drop.\n     *\n     * @return {Drop}\n     */\n    Maker.prototype.getDrop = function() {\n        return this._drop;\n    };\n\n    /**\n     * Get the whole display.\n     *\n     * @return {Node}\n     */\n    Maker.prototype.getDisplay = function() {\n        return this._getDisplayType(this._displayType);\n    };\n\n    /**\n     * Get the display by type.\n     *\n     * @param {String} displaytype The display type.\n     * @return {Drop}\n     */\n    Maker.prototype._getDisplayType = function(displaytype) {\n        var display,\n            anchor;\n\n        if (displaytype == this.IMAGE) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            window.console.log(display);\n            window.console.log('display');\n            anchor = this._getAnchor();\n            anchor.append(this._getDisplayImage());\n            display.append(anchor);\n\n        } else if (displaytype == this.IMAGEANDBUTTON) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            window.console.log(display);\n            window.console.log('display');\n            display.append(this._getDisplayImage());\n            display.append(this._getDisplayButton());\n\n        } else {\n            display = $('<span></span>');\n            window.console.log(display);\n            window.console.log('display');\n            anchor = this._getAnchor();\n            anchor.text(this._getLabel());\n            display.append(anchor);\n        }\n\n        return display;\n    };\n\n    /**\n     * Get the drop item.\n     *\n     * @return {Item}\n     */\n    Maker.prototype.getItem = function() {\n        return this._drop.getItem();\n    };\n\n    /**\n     * Get the label.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getLabel = function() {\n        if (this._label === null || this._label.trim() === '') {\n            return this.getDefaultLabel();\n        }\n        return this._label;\n    };\n\n    /**\n     * Get the snippet.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getSnippet = function() {\n        var node = $('<div>'),\n            uuid = this.uuid(),\n            wrapper = $('<span id=\"' + uuid + '\">'),\n            script = $('<script type=\"text/javascript\">'),\n            id = this.getDrop().get('id'),\n            hashcode = this.getDrop().get('hashcode'),\n            display = this.getDisplay(),\n            snippet = '';\n\n        // No need to scope this in an anonymous function, it already is because of require.\n        // WARNING! Changing this structure could break restores!\n        snippet = '' +\n            'require([\"jquery\", \"block_stash/drop\"], function($, D) {' +\n            ' var d = new D({id: ' + id + ', hashcode: \"' + hashcode + '\"}), n = $(\"#' + uuid + '\");' +\n            ' if (!n.length) return; n.removeClass(); d.isVisible().then(function() { n.show(); });' +\n            ' n.find(\"a, button\").click(function(e) { e.preventDefault(); d.pickup(); n.remove(); });' +\n            '})';\n        snippet = this._wrapForOnReady(snippet);\n\n        node.append(wrapper);\n        wrapper.css('display', 'none');\n        wrapper.append(display);\n        wrapper.append(script);\n        script.html(snippet);\n\n        return node.html();\n    };\n\n    /**\n     * Set the display type.\n     *\n     * @param {String} v The display type.\n     */\n    Maker.prototype.setDisplayType = function(v) {\n        this._displayType = v;\n    };\n\n    /**\n     * Set the action text.\n     *\n     * @param {String} v The action text.\n     */\n    Maker.prototype.setActionText = function(v) {\n        this._actionText = v;\n    };\n\n    /**\n     * Set the label.\n     *\n     * @param {String} v The label.\n     */\n    Maker.prototype.setLabel = function(v) {\n        this._label = v;\n    };\n\n    /**\n     * Get a unique ID.\n     *\n     * @return {String}\n     */\n    Maker.prototype.uuid = function() {\n        return (Math.random().toString(36).substring(2, 7)) + (((new Date()).getTime()).toString(36));\n    };\n\n    /**\n     * Wrap some script in a function waiting for the document to be ready.\n     *\n     * @param {String} code The script.\n     * @return {String} The new script.\n     */\n    Maker.prototype._wrapForOnReady = function(code) {\n        return 'document.addEventListener(\"DOMContentLoaded\", function(e) {' + code + '});';\n    };\n\n    return /** @alias module:block_stash/drop-snippet-maker */ Maker;\n\n});\n"],"names":["define","$","Maker","drop","_drop","prototype","IMAGE","IMAGEANDBUTTON","TEXT","_actionText","_displayType","_label","_getActionText","this","trim","getDefaultActionText","_getAnchor","getDefaultLabel","getItem","get","_getDisplayButton","wrap","btn","text","append","_getDisplayImage","img","label","addClass","css","attr","getDrop","getDisplay","_getDisplayType","displaytype","display","anchor","window","console","log","_getLabel","getSnippet","node","uuid","wrapper","script","id","hashcode","snippet","_wrapForOnReady","html","setDisplayType","v","setActionText","setLabel","Math","random","toString","substring","Date","getTime","code"],"mappings":"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"}